import{r as a,j as e}from"./index-COD1O9uy.js";import{u as V,L as ne,f as re,c as oe,b as ae,p as ie,T as le,d as Y,a as v,s as N,A as ce}from"./socket-VnnxQPBZ.js";const de=({sessions:n,onSelect:t,onCreate:x,onDelete:c,onLogout:m,onTogglePersist:r,onRefresh:l,isRefreshing:p})=>{const[j,b]=a.useState(""),{t:d}=V(),T=(s,i)=>{s.stopPropagation(),confirm(d("session_delete_confirm"))&&c(i)},_=(s,i)=>{s.stopPropagation(),oe(i).then(()=>{alert(d("session_copied"))}).catch(()=>{alert(d("session_copy_failed")+": "+i)})},h=(s,i,S)=>{s.stopPropagation(),r==null||r(i,S)},R=()=>{x(j.trim()||void 0),b("")},C=[...n].sort((s,i)=>s.is_persistent&&!i.is_persistent?-1:!s.is_persistent&&i.is_persistent?1:new Date(i.last_active).getTime()-new Date(s.last_active).getTime());return e.jsx("div",{className:"flex flex-col h-full bg-black text-white p-4 pb-safe",children:e.jsxs("div",{className:"w-full max-w-md mx-auto flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"text-center mb-4 flex-shrink-0",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 mb-2 shadow-lg shadow-green-500/20",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-lg font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent",children:d("app_name")})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[e.jsx("h2",{className:"text-base font-semibold text-white",children:d("sessions_title")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,disabled:p,className:"p-2 text-gray-400 hover:text-white transition-colors disabled:opacity-50",title:d("session_refresh"),children:e.jsx("svg",{className:`w-4 h-4 ${p?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx(ne,{}),e.jsxs("button",{onClick:m,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{className:"hidden sm:inline",children:d("logout")})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-2 mb-3 pr-1",children:C.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500 bg-gray-900/50 rounded-xl border border-gray-800/50",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("p",{children:d("sessions_empty")})]}):C.map(s=>e.jsx("div",{onClick:()=>t(s.id),className:`bg-gray-900/60 backdrop-blur-sm rounded-xl p-4 transition-all cursor-pointer hover:scale-[1.01] ${s.is_ghost?"border border-dashed border-gray-600 hover:border-green-500":s.is_persistent?"border border-yellow-600/40 hover:border-green-500":"border border-gray-800/50 hover:border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-mono text-base font-semibold text-gray-100 truncate",children:s.title||`Session ${s.id.substring(0,8)}`}),s.is_ghost&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-700/80 text-gray-400 rounded-md",children:d("session_state_idle")}),s.is_persistent&&e.jsx("svg",{className:"w-4 h-4 text-yellow-400 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1.5 flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${s.is_ghost?"bg-gray-500":s.state==="active"?"bg-green-500":"bg-yellow-500"}`}),e.jsx("span",{children:s.is_ghost?d("session_state_ghost"):s.state==="active"?d("session_state_active"):d("session_state_idle")}),e.jsx("span",{className:"text-gray-700",children:"â€¢"}),e.jsx("span",{children:re(s.last_active,d)})]})]}),e.jsxs("div",{className:"flex gap-1.5 ml-3",children:[e.jsx("button",{onClick:i=>h(i,s.id,!!s.is_persistent),className:`p-2 rounded-lg transition-all ${s.is_persistent?"bg-yellow-600/20 text-yellow-400 hover:bg-yellow-600/30":"bg-gray-800/80 text-gray-500 hover:bg-gray-700 hover:text-yellow-400"}`,title:s.is_persistent?d("session_persist_remove"):d("session_persist_add"),children:e.jsx("svg",{className:"h-4 w-4",fill:s.is_persistent?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:s.is_persistent?0:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),s.tmux_cmd&&!s.is_ghost&&e.jsx("button",{onClick:i=>_(i,s.tmux_cmd),className:"p-2 bg-gray-800/80 hover:bg-blue-600 text-gray-500 hover:text-white rounded-lg transition-all",title:d("session_copy_tmux"),children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),e.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]})}),e.jsx("button",{onClick:i=>T(i,s.id),className:"p-2 bg-gray-800/80 hover:bg-red-600 text-gray-500 hover:text-white rounded-lg transition-all",title:d("delete"),children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),t(s.id)},className:"px-3.5 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-lg font-medium transition-all text-sm shadow-lg shadow-green-500/10",children:s.is_ghost?d("session_revive"):d("session_join")})]})]})},s.id))}),e.jsxs("div",{className:"flex-shrink-0 bg-gray-900/40 backdrop-blur-sm rounded-xl p-3 border border-gray-800/50",children:[e.jsx("input",{type:"text",value:j,onChange:s=>b(s.target.value),placeholder:d("session_name_placeholder"),className:"w-full px-3 py-2 bg-black/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all mb-2 text-sm",onKeyDown:s=>s.key==="Enter"&&R()}),e.jsxs("button",{onClick:R,className:"w-full py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-lg font-semibold transition-all flex items-center justify-center gap-2 shadow-lg shadow-green-500/20 text-sm",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),e.jsx("span",{children:d("session_create")})]})]})]})})},X={autoReconnect:!0,lastSessionId:null,defaultWorkingDirectory:"~",fontSize:16,displayMode:"fit",fixedTerminalSize:{cols:100,rows:30},zoomLevel:1},ue=ae()(ie(n=>({...X,setAutoReconnect:t=>n({autoReconnect:t}),setLastSessionId:t=>n({lastSessionId:t}),setDefaultWorkingDirectory:t=>n({defaultWorkingDirectory:t}),setFontSize:t=>n({fontSize:t}),setDisplayMode:t=>n({displayMode:t}),setFixedTerminalSize:t=>n({fixedTerminalSize:t}),setZoomLevel:t=>n({zoomLevel:Math.max(.5,Math.min(2,t))}),resetZoom:()=>n({zoomLevel:1}),reset:()=>n(X)}),{name:"winterm-settings",partialize:n=>({autoReconnect:n.autoReconnect,lastSessionId:n.lastSessionId,defaultWorkingDirectory:n.defaultWorkingDirectory,fontSize:n.fontSize,displayMode:n.displayMode,fixedTerminalSize:n.fixedTerminalSize,zoomLevel:n.zoomLevel})}));function xe({status:n}){const x={connecting:{color:"bg-yellow-500",animate:"animate-pulse"},connected:{color:"bg-green-500",animate:""},disconnected:{color:"bg-red-500 ring-1 ring-red-400",animate:""}}[n];return e.jsx("div",{className:`w-2 h-2 rounded-full ${x.color} ${x.animate}`,"aria-label":`Connection status: ${n}`})}function he({status:n,sessionTitle:t,onReconnect:x,onLogout:c,onBackToSessions:m}){const{t:r}=V(),l=n==="disconnected";return e.jsxs("div",{className:`h-11 flex items-center justify-between px-2 shrink-0 transition-colors duration-200 ${l?"bg-red-900/20":"bg-gray-900/80 backdrop-blur"}`,children:[e.jsx("button",{onClick:m,className:"p-2 text-gray-400 active:bg-gray-700 rounded-lg transition-colors",title:r("session_back"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2 min-w-0 px-2",children:[e.jsx(xe,{status:n}),e.jsx("span",{className:"text-white text-sm font-medium truncate max-w-[160px]",children:t||r("app_name")}),l&&e.jsx("button",{onClick:x,className:"text-blue-400 text-xs px-2 py-0.5 bg-blue-500/10 rounded active:bg-blue-500/20",children:r("reconnect")})]}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 active:bg-gray-700 rounded-lg transition-colors",title:r("logout"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})}function me({visible:n,onClick:t}){return n?e.jsx("button",{onClick:t,className:"absolute right-4 bottom-4 w-10 h-10 rounded-full bg-gray-800/90 text-gray-300 flex items-center justify-center shadow-lg active:bg-gray-700 transition-all duration-200","aria-label":"Scroll to bottom",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}):null}function fe(n){const t=n.querySelector(".xterm-helper-textarea");if(!t)return()=>{};n.__mobileInput=t,t.dataset.allowFocus="false";const x=m=>{t.dataset.allowFocus!=="true"&&(m.preventDefault(),t.blur())},c=m=>{t.dataset.allowFocus!=="true"&&setTimeout(()=>{document.activeElement===t&&t.dataset.allowFocus!=="true"&&t.blur()},0)};return t.addEventListener("focus",x),n.addEventListener("touchend",c,{passive:!0}),()=>{delete n.__mobileInput,t.removeEventListener("focus",x),n.removeEventListener("touchend",c)}}const W=4,G=2,ge=.2;function pe({socket:n,fontSize:t,fixedSize:x,isInputActive:c,onTerminalReady:m}){const r=a.useRef(null),l=a.useRef(null),p=a.useRef(null),j=a.useRef(null),b=a.useRef(null),[d,T]=a.useState(!1),_=a.useRef(null),h=a.useRef({lastY:0,lastX:0,delta:0,direction:0,lastSendTime:0}),R=a.useCallback((s,i,S)=>{r.current=s,l.current=i,p.current=S,b.current=fe(i),m==null||m(s)},[m]);a.useEffect(()=>{const s=_.current;if(!s)return;const i=L=>{const w=L.touches[0];h.current={lastY:w.clientY,lastX:w.clientX,delta:0,direction:0,lastSendTime:0}},S=L=>{L.preventDefault(),L.stopPropagation();const w=r.current,I=l.current;if(!w||!I)return;const P=L.touches[0],F=P.clientY,D=P.clientX,y=h.current.lastY-F;h.current.lastY=F,h.current.lastX=D;const z=y>0?1:y<0?-1:0;h.current.direction===0?Math.abs(y)>G&&(h.current.direction=z,h.current.delta+=y):z===h.current.direction?h.current.delta+=y:Math.abs(y)>G*2&&(h.current.direction=z,h.current.delta=y);const H=performance.now();for(;Math.abs(h.current.delta)>=W&&!(H-h.current.lastSendTime<ge);){const k=I.getBoundingClientRect(),$=w.cols||80,O=w.rows||24;let E=Math.ceil((D-k.left)/(k.width/$)),M=Math.ceil((F-k.top)/(k.height/O));E=Math.max(1,Math.min(E,$)),M=Math.max(1,Math.min(M,O)),h.current.delta>0?(n.sendInput(`\x1B[<65;${E};${M}M`),h.current.delta-=W):(n.sendInput(`\x1B[<64;${E};${M}M`),h.current.delta+=W),h.current.lastSendTime=H}};return s.addEventListener("touchstart",i,{passive:!0,capture:!0}),s.addEventListener("touchmove",S,{passive:!1,capture:!0}),()=>{s.removeEventListener("touchstart",i,{capture:!0}),s.removeEventListener("touchmove",S,{capture:!0})}},[n]),a.useEffect(()=>{const s=l.current;if(!s)return;const i=s.__mobileInput;i&&(c?(i.dataset.allowFocus="true",i.focus(),p.current&&(setTimeout(p.current,100),setTimeout(p.current,300),setTimeout(p.current,500))):(i.blur(),i.dataset.allowFocus="false",p.current&&(setTimeout(p.current,100),setTimeout(p.current,300))))},[c]),a.useEffect(()=>()=>{var s,i;(s=j.current)==null||s.call(j),(i=b.current)==null||i.call(b)},[]);const C=a.useCallback(()=>{var s;(s=r.current)==null||s.scrollToBottom(),T(!1)},[]);return e.jsxs("div",{ref:_,className:"flex-1 overflow-hidden relative",style:{touchAction:"none"},children:[e.jsx(le,{socket:n,fontSize:t,fixedSize:x,disableClickFocus:!0,onTerminalReady:R}),e.jsx(me,{visible:d,onClick:C})]})}function B({label:n,onPress:t,wide:x=!1,highlight:c=!1}){return e.jsx("button",{onClick:t,className:`text-xs py-2 rounded active:bg-gray-700 min-h-[40px] transition-colors ${x?"px-3":"px-2 min-w-[40px]"} ${c?"bg-gray-700 text-yellow-400":"bg-gray-800 text-gray-300"}`,children:n})}function be({isOpen:n,onSendKey:t}){if(!n)return null;const x=[{label:"^C",code:"",desc:"Interrupt"},{label:"^D",code:"",desc:"EOF"},{label:"^Z",code:"",desc:"Suspend"},{label:"^L",code:"\f",desc:"Clear"},{label:"^A",code:"",desc:"Home"},{label:"^E",code:"",desc:"End"},{label:"^U",code:"",desc:"Kill line"},{label:"^K",code:"\v",desc:"Kill to end"},{label:"^W",code:"",desc:"Kill word"},{label:"^R",code:"",desc:"Search"},{label:"^P",code:"",desc:"Prev"},{label:"^N",code:"",desc:"Next"}],c=["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],m={F1:"\x1BOP",F2:"\x1BOQ",F3:"\x1BOR",F4:"\x1BOS",F5:"\x1B[15~",F6:"\x1B[17~",F7:"\x1B[18~",F8:"\x1B[19~",F9:"\x1B[20~",F10:"\x1B[21~",F11:"\x1B[23~",F12:"\x1B[24~"},r=[{label:"HOME",code:"\x1B[H"},{label:"END",code:"\x1B[F"},{label:"PGUP",code:"\x1B[5~"},{label:"PGDN",code:"\x1B[6~"},{label:"INS",code:"\x1B[2~"},{label:"DEL",code:"\x1B[3~"}];return e.jsxs("div",{className:"bg-gray-900 border-t border-gray-800 p-2 space-y-3 animate-in slide-in-from-bottom duration-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"Ctrl ç»„åˆé”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:x.map(l=>e.jsx(B,{label:l.label,onPress:()=>t(l.code),highlight:!0},l.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"æ–¹å‘é”®"}),e.jsx("div",{className:"flex justify-center gap-1",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("div",{}),e.jsx(B,{label:"â†‘",onPress:()=>t("\x1B[A")}),e.jsx("div",{}),e.jsx(B,{label:"â†",onPress:()=>t("\x1B[D")}),e.jsx(B,{label:"â†“",onPress:()=>t("\x1B[B")}),e.jsx(B,{label:"â†’",onPress:()=>t("\x1B[C")})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"å¯¼èˆªé”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:r.map(l=>e.jsx(B,{label:l.label,onPress:()=>t(l.code),wide:!0},l.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"åŠŸèƒ½é”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:c.map(l=>e.jsx(B,{label:l,onPress:()=>t(m[l])},l))})]})]})}function A({label:n,onClick:t,className:x=""}){return e.jsx("button",{onClick:t,className:`text-gray-300 text-xs px-2 py-2 bg-gray-800 rounded active:bg-gray-700 min-w-[40px] min-h-[44px] transition-colors ${x}`,children:n})}function ve({onSendKey:n,isInputActive:t,onInputToggle:x}){const[c,m]=a.useState(!1),r=l=>{n(l)};return e.jsxs(e.Fragment,{children:[e.jsx(be,{isOpen:c,onSendKey:r}),e.jsxs("div",{className:"flex items-center justify-around bg-gray-900 shrink-0 px-2 py-1 gap-1",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("button",{onClick:x,className:`text-xs font-medium px-3 py-2 rounded min-w-[50px] min-h-[44px] transition-colors border-2 ${t?"bg-blue-600 border-blue-400 text-white":"bg-gray-900 border-blue-500 text-blue-400 active:bg-blue-900"}`,children:t?"âŒ¨ ON":"âŒ¨"}),e.jsx(A,{label:"ESC",onClick:()=>r("\x1B")}),e.jsx(A,{label:"TAB",onClick:()=>r("	")}),e.jsx(A,{label:"â†‘",onClick:()=>r("\x1B[A")}),e.jsx(A,{label:"â†“",onClick:()=>r("\x1B[B")}),e.jsx("button",{onClick:()=>r("\r"),className:"text-xs font-medium px-3 py-2 rounded min-w-[44px] min-h-[44px] transition-colors bg-green-700 text-white active:bg-green-600",children:"âŽ"}),e.jsx("button",{onClick:()=>m(!c),className:"text-gray-300 text-xs px-2 py-2 bg-gray-800 rounded active:bg-gray-700 min-w-[40px] min-h-[44px] transition-colors",children:c?"â–¼":"â€¢â€¢â€¢"})]})]})}function je(n){const[t,x]=a.useState(null),c=a.useRef(null),m=a.useRef(!1);return a.useEffect(()=>{const r=window.visualViewport;if(!r)return;c.current===null&&(c.current=r.height);const l=()=>{const p=r.height;x(p),r.offsetTop>0&&window.scrollTo(0,0);const j=c.current;if(j){const d=j-p>100;m.current&&!d&&(n==null||n()),m.current=d}};return l(),r.addEventListener("resize",l),r.addEventListener("scroll",l),()=>{r.removeEventListener("resize",l),r.removeEventListener("scroll",l)}},[n]),t}function Se(){const[n,t]=a.useState("disconnected"),[x,c]=a.useState("loading"),[m,r]=a.useState([]),[l,p]=a.useState(),[j,b]=a.useState(""),[d,T]=a.useState(""),[_,h]=a.useState(!1),[R,C]=a.useState(!1),s=a.useRef(null),i=a.useRef(!1),S=a.useRef(!1),{t:L}=V(),{defaultWorkingDirectory:w,fontSize:I,displayMode:P,fixedTerminalSize:F,setLastSessionId:D}=ue(),{consumeModifiers:y}=Y(),z=a.useCallback(()=>{h(!1)},[]),H=je(z),k=a.useCallback(async o=>{if(!i.current){i.current=!0,t("connecting"),b("");try{const{ws_url:u}=await v.attachSession(o);N.connectWithToken(u,o),p(o),D(o),localStorage.setItem("winterm_session",o)}catch(u){b(u instanceof Error?u.message:"Failed to connect"),t("disconnected"),c("selecting_session"),p(void 0)}finally{i.current=!1}}},[D]);a.useEffect(()=>{if(S.current)return;S.current=!0,(async()=>{try{if(!(await v.validateToken()).valid){c("unauthenticated");return}const{sessions:f}=await v.listSessions();if(r(f),f.length===0){const{session:g}=await v.createSession({workingDirectory:w});r([g])}c("selecting_session")}catch{c("unauthenticated")}})()},[w]),a.useEffect(()=>{const o=N.onOpen(()=>{t("connected"),b("")}),u=N.onClose(()=>{t("disconnected")}),f=N.onError(g=>{b(g),t("disconnected")});return()=>{o(),u(),f()}},[]);const $=async o=>{try{T("");const{token:u}=await v.authenticate(o);localStorage.setItem("winterm_token",u);const{sessions:f}=await v.listSessions();if(r(f),f.length===0){const{session:g}=await v.createSession({workingDirectory:w});r([g]),c("ready"),k(g.id)}else c("selecting_session")}catch(u){T(u instanceof Error?u.message:"Authentication failed")}},O=o=>{c("ready"),k(o)},E=async o=>{const{session:u}=await v.createSession({title:o,workingDirectory:w});r(f=>[...f,u]),c("ready"),k(u.id)},M=async o=>{await v.deleteSession(o),r(u=>u.filter(f=>f.id!==o))},U=async()=>{C(!0);try{const{sessions:o}=await v.listSessions();r(o)}catch{}finally{C(!1)}},Z=async(o,u)=>{r(f=>f.map(g=>g.id===o?{...g,is_persistent:!u}:g));try{u?await v.unpersistSession(o):await v.persistSession(o)}catch{r(f=>f.map(g=>g.id===o?{...g,is_persistent:u}:g))}},K=()=>{N.disconnect(),localStorage.removeItem("winterm_token"),localStorage.removeItem("winterm_session"),c("unauthenticated"),t("disconnected"),p(void 0),r([])},q=a.useCallback(o=>{s.current=o},[]),Q=()=>{l&&k(l)},J=a.useCallback(async()=>{N.disconnect(),p(void 0);try{const{sessions:o}=await v.listSessions();r(o)}catch{}c("selecting_session")},[]),ee=a.useCallback(o=>{const{modifiers:u}=Y.getState();let f=o;if(u.ctrl!=="idle"&&o.length===1){const g=o.charCodeAt(0);g>=97&&g<=122?f=String.fromCharCode(g-96):g>=65&&g<=90&&(f=String.fromCharCode(g-64))}u.alt!=="idle"&&(f=`\x1B${f}`),N.sendInput(f),y()},[y]),te=a.useCallback(()=>{h(o=>!o)},[]),se=()=>{if(x==="unauthenticated")return e.jsx(ce,{onSubmit:$,error:d});if(x==="loading")return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 mb-4 shadow-lg shadow-green-500/20",children:e.jsx("svg",{className:"w-7 h-7 text-white animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"text-gray-400",children:L("loading")})]})});if(x==="selecting_session")return e.jsx(de,{sessions:m,onSelect:O,onCreate:E,onDelete:M,onLogout:K,onTogglePersist:Z,onRefresh:U,isRefreshing:R});const o=m.find(u=>u.id===l);return e.jsxs(e.Fragment,{children:[e.jsx(he,{status:n,sessionTitle:(o==null?void 0:o.title)||(l?`Session ${l.substring(0,8)}`:void 0),onReconnect:Q,onLogout:K,onBackToSessions:J}),j&&e.jsx("div",{className:"bg-red-900/50 text-red-300 text-sm px-3 py-2 shrink-0",children:j}),e.jsx(pe,{socket:N,fontSize:I,fixedSize:P==="fixed"?F:void 0,isInputActive:_,onTerminalReady:q}),e.jsx(ve,{onSendKey:ee,isInputActive:_,onInputToggle:te})]})};return e.jsx("div",{className:"flex flex-col bg-black overflow-hidden fixed inset-0",style:{height:H?`${H}px`:"100dvh"},children:se()})}export{Se as default};
