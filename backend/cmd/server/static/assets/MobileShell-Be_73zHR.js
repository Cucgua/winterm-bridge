import{r as o,j as e}from"./index-Diw98krf.js";import{u as V,L as ee,f as te,c as se,b as ne,p as re,T as oe,d as K,a as w,s as B,A as ae}from"./socket-BcXkhQeR.js";const ie=({sessions:s,onSelect:t,onCreate:u,onDelete:l,onLogout:g,onTogglePersist:r})=>{const[i,b]=o.useState(""),{t:c}=V(),j=(n,x)=>{n.stopPropagation(),confirm(c("session_delete_confirm"))&&l(x)},N=(n,x)=>{n.stopPropagation(),se(x).then(()=>{alert(c("session_copied"))}).catch(()=>{alert(c("session_copy_failed")+": "+x)})},M=(n,x,m)=>{n.stopPropagation(),r==null||r(x,m)},k=()=>{u(i.trim()||void 0),b("")},h=[...s].sort((n,x)=>n.is_persistent&&!x.is_persistent?-1:!n.is_persistent&&x.is_persistent?1:new Date(x.last_active).getTime()-new Date(n.last_active).getTime());return e.jsx("div",{className:"flex flex-col h-full bg-black text-white p-4 pb-safe",children:e.jsxs("div",{className:"w-full max-w-md mx-auto flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"text-center mb-4 flex-shrink-0",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 mb-2 shadow-lg shadow-green-500/20",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-lg font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent",children:c("app_name")})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[e.jsx("h2",{className:"text-base font-semibold text-white",children:c("sessions_title")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{}),e.jsxs("button",{onClick:g,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{className:"hidden sm:inline",children:c("logout")})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-2 mb-3 pr-1",children:h.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500 bg-gray-900/50 rounded-xl border border-gray-800/50",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("p",{children:c("sessions_empty")})]}):h.map(n=>e.jsx("div",{onClick:()=>t(n.id),className:`bg-gray-900/60 backdrop-blur-sm rounded-xl p-4 transition-all cursor-pointer hover:scale-[1.01] ${n.is_ghost?"border border-dashed border-gray-600 hover:border-green-500":n.is_persistent?"border border-yellow-600/40 hover:border-green-500":"border border-gray-800/50 hover:border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-mono text-base font-semibold text-gray-100 truncate",children:n.title||`Session ${n.id.substring(0,8)}`}),n.is_ghost&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-700/80 text-gray-400 rounded-md",children:c("session_state_idle")}),n.is_persistent&&e.jsx("svg",{className:"w-4 h-4 text-yellow-400 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1.5 flex items-center gap-2",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${n.is_ghost?"bg-gray-500":n.state==="active"?"bg-green-500":"bg-yellow-500"}`}),e.jsx("span",{children:n.is_ghost?c("session_state_ghost"):n.state==="active"?c("session_state_active"):c("session_state_idle")}),e.jsx("span",{className:"text-gray-700",children:"â€¢"}),e.jsx("span",{children:te(n.last_active,c)})]})]}),e.jsxs("div",{className:"flex gap-1.5 ml-3",children:[e.jsx("button",{onClick:x=>M(x,n.id,!!n.is_persistent),className:`p-2 rounded-lg transition-all ${n.is_persistent?"bg-yellow-600/20 text-yellow-400 hover:bg-yellow-600/30":"bg-gray-800/80 text-gray-500 hover:bg-gray-700 hover:text-yellow-400"}`,title:n.is_persistent?c("session_persist_remove"):c("session_persist_add"),children:e.jsx("svg",{className:"h-4 w-4",fill:n.is_persistent?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:n.is_persistent?0:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),n.tmux_cmd&&!n.is_ghost&&e.jsx("button",{onClick:x=>N(x,n.tmux_cmd),className:"p-2 bg-gray-800/80 hover:bg-blue-600 text-gray-500 hover:text-white rounded-lg transition-all",title:c("session_copy_tmux"),children:e.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),e.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]})}),e.jsx("button",{onClick:x=>j(x,n.id),className:"p-2 bg-gray-800/80 hover:bg-red-600 text-gray-500 hover:text-white rounded-lg transition-all",title:c("delete"),children:e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),t(n.id)},className:"px-3.5 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-lg font-medium transition-all text-sm shadow-lg shadow-green-500/10",children:n.is_ghost?c("session_revive"):c("session_join")})]})]})},n.id))}),e.jsxs("div",{className:"flex-shrink-0 bg-gray-900/40 backdrop-blur-sm rounded-xl p-3 border border-gray-800/50",children:[e.jsx("input",{type:"text",value:i,onChange:n=>b(n.target.value),placeholder:c("session_name_placeholder"),className:"w-full px-3 py-2 bg-black/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all mb-2 text-sm",onKeyDown:n=>n.key==="Enter"&&k()}),e.jsxs("button",{onClick:k,className:"w-full py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-lg font-semibold transition-all flex items-center justify-center gap-2 shadow-lg shadow-green-500/20 text-sm",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),e.jsx("span",{children:c("session_create")})]})]})]})})},Y={autoReconnect:!0,lastSessionId:null,defaultWorkingDirectory:"~",fontSize:16,displayMode:"fit",fixedTerminalSize:{cols:100,rows:30},zoomLevel:1},le=ne()(re(s=>({...Y,setAutoReconnect:t=>s({autoReconnect:t}),setLastSessionId:t=>s({lastSessionId:t}),setDefaultWorkingDirectory:t=>s({defaultWorkingDirectory:t}),setFontSize:t=>s({fontSize:t}),setDisplayMode:t=>s({displayMode:t}),setFixedTerminalSize:t=>s({fixedTerminalSize:t}),setZoomLevel:t=>s({zoomLevel:Math.max(.5,Math.min(2,t))}),resetZoom:()=>s({zoomLevel:1}),reset:()=>s(Y)}),{name:"winterm-settings",partialize:s=>({autoReconnect:s.autoReconnect,lastSessionId:s.lastSessionId,defaultWorkingDirectory:s.defaultWorkingDirectory,fontSize:s.fontSize,displayMode:s.displayMode,fixedTerminalSize:s.fixedTerminalSize,zoomLevel:s.zoomLevel})}));function ce({status:s}){const u={connecting:{color:"bg-yellow-500",animate:"animate-pulse"},connected:{color:"bg-green-500",animate:""},disconnected:{color:"bg-red-500 ring-1 ring-red-400",animate:""}}[s];return e.jsx("div",{className:`w-2 h-2 rounded-full ${u.color} ${u.animate}`,"aria-label":`Connection status: ${s}`})}function de({status:s,sessionTitle:t,onReconnect:u,onLogout:l,onBackToSessions:g}){const{t:r}=V(),i=s==="disconnected";return e.jsxs("div",{className:`h-11 flex items-center justify-between px-2 shrink-0 transition-colors duration-200 ${i?"bg-red-900/20":"bg-gray-900/80 backdrop-blur"}`,children:[e.jsx("button",{onClick:g,className:"p-2 text-gray-400 active:bg-gray-700 rounded-lg transition-colors",title:r("session_back"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2 min-w-0 px-2",children:[e.jsx(ce,{status:s}),e.jsx("span",{className:"text-white text-sm font-medium truncate max-w-[160px]",children:t||r("app_name")}),i&&e.jsx("button",{onClick:u,className:"text-blue-400 text-xs px-2 py-0.5 bg-blue-500/10 rounded active:bg-blue-500/20",children:r("reconnect")})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 active:bg-gray-700 rounded-lg transition-colors",title:r("logout"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})}function ue({visible:s,onClick:t}){return s?e.jsx("button",{onClick:t,className:"absolute right-4 bottom-4 w-10 h-10 rounded-full bg-gray-800/90 text-gray-300 flex items-center justify-center shadow-lg active:bg-gray-700 transition-all duration-200","aria-label":"Scroll to bottom",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}):null}function xe(s){const t=s.querySelector(".xterm-helper-textarea");if(!t)return()=>{};s.__mobileInput=t,t.dataset.allowFocus="false";const u=g=>{t.dataset.allowFocus!=="true"&&(g.preventDefault(),t.blur())},l=g=>{t.dataset.allowFocus!=="true"&&setTimeout(()=>{document.activeElement===t&&t.dataset.allowFocus!=="true"&&t.blur()},0)};return t.addEventListener("focus",u),s.addEventListener("touchend",l,{passive:!0}),()=>{delete s.__mobileInput,t.removeEventListener("focus",u),s.removeEventListener("touchend",l)}}const W=4,X=2,he=.2;function me({socket:s,fontSize:t,fixedSize:u,isInputActive:l,onTerminalReady:g}){const r=o.useRef(null),i=o.useRef(null),b=o.useRef(null),c=o.useRef(null),j=o.useRef(null),[N,M]=o.useState(!1),k=o.useRef(null),h=o.useRef({lastY:0,lastX:0,delta:0,direction:0,lastSendTime:0}),n=o.useCallback((m,v,S)=>{r.current=m,i.current=v,b.current=S,j.current=xe(v),g==null||g(m)},[g]);o.useEffect(()=>{const m=k.current;if(!m)return;const v=L=>{const _=L.touches[0];h.current={lastY:_.clientY,lastX:_.clientX,delta:0,direction:0,lastSendTime:0}},S=L=>{L.preventDefault(),L.stopPropagation();const _=r.current,H=i.current;if(!_||!H)return;const z=L.touches[0],R=z.clientY,I=z.clientX,y=h.current.lastY-R;h.current.lastY=R,h.current.lastX=I;const C=y>0?1:y<0?-1:0;h.current.direction===0?Math.abs(y)>X&&(h.current.direction=C,h.current.delta+=y):C===h.current.direction?h.current.delta+=y:Math.abs(y)>X*2&&(h.current.direction=C,h.current.delta=y);const P=performance.now();for(;Math.abs(h.current.delta)>=W&&!(P-h.current.lastSendTime<he);){const F=H.getBoundingClientRect(),O=_.cols||80,$=_.rows||24;let D=Math.ceil((I-F.left)/(F.width/O)),T=Math.ceil((R-F.top)/(F.height/$));D=Math.max(1,Math.min(D,O)),T=Math.max(1,Math.min(T,$)),h.current.delta>0?(s.sendInput(`\x1B[<65;${D};${T}M`),h.current.delta-=W):(s.sendInput(`\x1B[<64;${D};${T}M`),h.current.delta+=W),h.current.lastSendTime=P}};return m.addEventListener("touchstart",v,{passive:!0,capture:!0}),m.addEventListener("touchmove",S,{passive:!1,capture:!0}),()=>{m.removeEventListener("touchstart",v,{capture:!0}),m.removeEventListener("touchmove",S,{capture:!0})}},[s]),o.useEffect(()=>{const m=i.current;if(!m)return;const v=m.__mobileInput;v&&(l?(v.dataset.allowFocus="true",v.focus(),b.current&&(setTimeout(b.current,100),setTimeout(b.current,300),setTimeout(b.current,500))):(v.blur(),v.dataset.allowFocus="false",b.current&&(setTimeout(b.current,100),setTimeout(b.current,300))))},[l]),o.useEffect(()=>()=>{var m,v;(m=c.current)==null||m.call(c),(v=j.current)==null||v.call(j)},[]);const x=o.useCallback(()=>{var m;(m=r.current)==null||m.scrollToBottom(),M(!1)},[]);return e.jsxs("div",{ref:k,className:"flex-1 overflow-hidden relative",style:{touchAction:"none"},children:[e.jsx(oe,{socket:s,fontSize:t,fixedSize:u,disableClickFocus:!0,onTerminalReady:n}),e.jsx(ue,{visible:N,onClick:x})]})}function E({label:s,onPress:t,wide:u=!1,highlight:l=!1}){return e.jsx("button",{onClick:t,className:`text-xs py-2 rounded active:bg-gray-700 min-h-[40px] transition-colors ${u?"px-3":"px-2 min-w-[40px]"} ${l?"bg-gray-700 text-yellow-400":"bg-gray-800 text-gray-300"}`,children:s})}function ge({isOpen:s,onSendKey:t}){if(!s)return null;const u=[{label:"^C",code:"",desc:"Interrupt"},{label:"^D",code:"",desc:"EOF"},{label:"^Z",code:"",desc:"Suspend"},{label:"^L",code:"\f",desc:"Clear"},{label:"^A",code:"",desc:"Home"},{label:"^E",code:"",desc:"End"},{label:"^U",code:"",desc:"Kill line"},{label:"^K",code:"\v",desc:"Kill to end"},{label:"^W",code:"",desc:"Kill word"},{label:"^R",code:"",desc:"Search"},{label:"^P",code:"",desc:"Prev"},{label:"^N",code:"",desc:"Next"}],l=["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],g={F1:"\x1BOP",F2:"\x1BOQ",F3:"\x1BOR",F4:"\x1BOS",F5:"\x1B[15~",F6:"\x1B[17~",F7:"\x1B[18~",F8:"\x1B[19~",F9:"\x1B[20~",F10:"\x1B[21~",F11:"\x1B[23~",F12:"\x1B[24~"},r=[{label:"HOME",code:"\x1B[H"},{label:"END",code:"\x1B[F"},{label:"PGUP",code:"\x1B[5~"},{label:"PGDN",code:"\x1B[6~"},{label:"INS",code:"\x1B[2~"},{label:"DEL",code:"\x1B[3~"}];return e.jsxs("div",{className:"bg-gray-900 border-t border-gray-800 p-2 space-y-3 animate-in slide-in-from-bottom duration-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"Ctrl ç»„åˆé”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:u.map(i=>e.jsx(E,{label:i.label,onPress:()=>t(i.code),highlight:!0},i.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"æ–¹å‘é”®"}),e.jsx("div",{className:"flex justify-center gap-1",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("div",{}),e.jsx(E,{label:"â†‘",onPress:()=>t("\x1B[A")}),e.jsx("div",{}),e.jsx(E,{label:"â†",onPress:()=>t("\x1B[D")}),e.jsx(E,{label:"â†“",onPress:()=>t("\x1B[B")}),e.jsx(E,{label:"â†’",onPress:()=>t("\x1B[C")})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"å¯¼èˆªé”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:r.map(i=>e.jsx(E,{label:i.label,onPress:()=>t(i.code),wide:!0},i.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"åŠŸèƒ½é”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:l.map(i=>e.jsx(E,{label:i,onPress:()=>t(g[i])},i))})]})]})}function A({label:s,onClick:t,className:u=""}){return e.jsx("button",{onClick:t,className:`text-gray-300 text-xs px-2 py-2 bg-gray-800 rounded active:bg-gray-700 min-w-[40px] min-h-[44px] transition-colors ${u}`,children:s})}function fe({onSendKey:s,isInputActive:t,onInputToggle:u}){const[l,g]=o.useState(!1),r=i=>{s(i)};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{isOpen:l,onSendKey:r}),e.jsxs("div",{className:"flex items-center justify-around bg-gray-900 shrink-0 px-2 py-1 gap-1",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("button",{onClick:u,className:`text-xs font-medium px-3 py-2 rounded min-w-[50px] min-h-[44px] transition-colors border-2 ${t?"bg-blue-600 border-blue-400 text-white":"bg-gray-900 border-blue-500 text-blue-400 active:bg-blue-900"}`,children:t?"âŒ¨ ON":"âŒ¨"}),e.jsx(A,{label:"ESC",onClick:()=>r("\x1B")}),e.jsx(A,{label:"TAB",onClick:()=>r("	")}),e.jsx(A,{label:"â†‘",onClick:()=>r("\x1B[A")}),e.jsx(A,{label:"â†“",onClick:()=>r("\x1B[B")}),e.jsx("button",{onClick:()=>r("\r"),className:"text-xs font-medium px-3 py-2 rounded min-w-[44px] min-h-[44px] transition-colors bg-green-700 text-white active:bg-green-600",children:"âŽ"}),e.jsx("button",{onClick:()=>g(!l),className:"text-gray-300 text-xs px-2 py-2 bg-gray-800 rounded active:bg-gray-700 min-w-[40px] min-h-[44px] transition-colors",children:l?"â–¼":"â€¢â€¢â€¢"})]})]})}function pe(s){const[t,u]=o.useState(null),l=o.useRef(null),g=o.useRef(!1);return o.useEffect(()=>{const r=window.visualViewport;if(!r)return;l.current===null&&(l.current=r.height);const i=()=>{const b=r.height;u(b),r.offsetTop>0&&window.scrollTo(0,0);const c=l.current;if(c){const N=c-b>100;g.current&&!N&&(s==null||s()),g.current=N}};return i(),r.addEventListener("resize",i),r.addEventListener("scroll",i),()=>{r.removeEventListener("resize",i),r.removeEventListener("scroll",i)}},[s]),t}function je(){const[s,t]=o.useState("disconnected"),[u,l]=o.useState("loading"),[g,r]=o.useState([]),[i,b]=o.useState(),[c,j]=o.useState(""),[N,M]=o.useState(""),[k,h]=o.useState(!1),n=o.useRef(null),x=o.useRef(!1),m=o.useRef(!1),{t:v}=V(),{defaultWorkingDirectory:S,fontSize:L,displayMode:_,fixedTerminalSize:H,setLastSessionId:z}=le(),{consumeModifiers:R}=K(),I=o.useCallback(()=>{h(!1)},[]),y=pe(I),C=o.useCallback(async a=>{if(!x.current){x.current=!0,t("connecting"),j("");try{const{ws_url:d}=await w.attachSession(a);B.connectWithToken(d,a),b(a),z(a),localStorage.setItem("winterm_session",a)}catch(d){j(d instanceof Error?d.message:"Failed to connect"),t("disconnected"),l("selecting_session"),b(void 0)}finally{x.current=!1}}},[z]);o.useEffect(()=>{if(m.current)return;m.current=!0,(async()=>{try{if(!(await w.validateToken()).valid){l("unauthenticated");return}const{sessions:f}=await w.listSessions();if(r(f),f.length===0){const{session:p}=await w.createSession({workingDirectory:S});r([p])}l("selecting_session")}catch{l("unauthenticated")}})()},[S]),o.useEffect(()=>{const a=B.onOpen(()=>{t("connected"),j("")}),d=B.onClose(()=>{t("disconnected")}),f=B.onError(p=>{j(p),t("disconnected")});return()=>{a(),d(),f()}},[]);const P=async a=>{try{M("");const{token:d}=await w.authenticate(a);localStorage.setItem("winterm_token",d);const{sessions:f}=await w.listSessions();if(r(f),f.length===0){const{session:p}=await w.createSession({workingDirectory:S});r([p]),l("ready"),C(p.id)}else l("selecting_session")}catch(d){M(d instanceof Error?d.message:"Authentication failed")}},F=a=>{l("ready"),C(a)},O=async a=>{const{session:d}=await w.createSession({title:a,workingDirectory:S});r(f=>[...f,d]),l("ready"),C(d.id)},$=async a=>{await w.deleteSession(a),r(d=>d.filter(f=>f.id!==a))},D=async(a,d)=>{r(f=>f.map(p=>p.id===a?{...p,is_persistent:!d}:p));try{d?await w.unpersistSession(a):await w.persistSession(a)}catch{r(f=>f.map(p=>p.id===a?{...p,is_persistent:d}:p))}},T=()=>{B.disconnect(),localStorage.removeItem("winterm_token"),localStorage.removeItem("winterm_session"),l("unauthenticated"),t("disconnected"),b(void 0),r([])},G=o.useCallback(a=>{n.current=a},[]),U=()=>{i&&C(i)},Z=o.useCallback(async()=>{B.disconnect(),b(void 0);try{const{sessions:a}=await w.listSessions();r(a)}catch{}l("selecting_session")},[]),q=o.useCallback(a=>{const{modifiers:d}=K.getState();let f=a;if(d.ctrl!=="idle"&&a.length===1){const p=a.charCodeAt(0);p>=97&&p<=122?f=String.fromCharCode(p-96):p>=65&&p<=90&&(f=String.fromCharCode(p-64))}d.alt!=="idle"&&(f=`\x1B${f}`),B.sendInput(f),R()},[R]),Q=o.useCallback(()=>{h(a=>!a)},[]),J=()=>{if(u==="unauthenticated")return e.jsx(ae,{onSubmit:P,error:N});if(u==="loading")return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 mb-4 shadow-lg shadow-green-500/20",children:e.jsx("svg",{className:"w-7 h-7 text-white animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"text-gray-400",children:v("loading")})]})});if(u==="selecting_session")return e.jsx(ie,{sessions:g,onSelect:F,onCreate:O,onDelete:$,onLogout:T,onTogglePersist:D});const a=g.find(d=>d.id===i);return e.jsxs(e.Fragment,{children:[e.jsx(de,{status:s,sessionTitle:(a==null?void 0:a.title)||(i?`Session ${i.substring(0,8)}`:void 0),onReconnect:U,onLogout:T,onBackToSessions:Z}),c&&e.jsx("div",{className:"bg-red-900/50 text-red-300 text-sm px-3 py-2 shrink-0",children:c}),e.jsx(me,{socket:B,fontSize:L,fixedSize:_==="fixed"?H:void 0,isInputActive:k,onTerminalReady:G}),e.jsx(fe,{onSendKey:q,isInputActive:k,onInputToggle:Q})]})};return e.jsx("div",{className:"flex flex-col bg-black overflow-hidden fixed inset-0",style:{height:y?`${y}px`:"100dvh"},children:J()})}export{je as default};
