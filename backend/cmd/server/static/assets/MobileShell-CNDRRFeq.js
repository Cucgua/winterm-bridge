import{r as a,j as e}from"./index-DRxHKf7d.js";import{u as Y,a as V,L as le,A as ce,f as de,b as ue,c as w,d as xe,i as he,p as me,T as fe,j as G,s as M,h as ge}from"./socket-CHr75UAH.js";const pe=({sessions:n,onSelect:t,onCreate:u,onDelete:c,onLogout:v,onTogglePersist:o,onToggleNotify:i,onRefresh:j,isRefreshing:k})=>{const[y,_]=a.useState(""),[z,B]=a.useState(!1),[g,R]=a.useState({}),{t:d}=Y(),b=V(s=>s.aiEnabled),m=V(s=>s.summaries);a.useEffect(()=>{const s=async()=>{const l={};for(const h of n)try{const N=await w.getSessionSettings(h.id);l[h.id]=N.notify_enabled}catch{l[h.id]=!1}R(l)};n.length>0&&s()},[n]);const C=(s,l)=>{s.stopPropagation(),confirm(d("session_delete_confirm"))&&c(l)},L=(s,l)=>{s.stopPropagation(),xe(l).then(()=>{alert(d("session_copied"))}).catch(()=>{alert(d("session_copy_failed")+": "+l)})},S=(s,l,h)=>{s.stopPropagation(),o==null||o(l,h)},H=async(s,l)=>{s.stopPropagation();const h=g[l]??!1;R(N=>({...N,[l]:!h}));try{h?await w.disableSessionNotify(l):await w.enableSessionNotify(l),i==null||i(l,h)}catch{R(N=>({...N,[l]:h}))}},T=()=>{u(y.trim()||void 0),_("")},E=[...n].sort((s,l)=>s.is_persistent&&!l.is_persistent?-1:!s.is_persistent&&l.is_persistent?1:new Date(s.created_at).getTime()-new Date(l.created_at).getTime());return e.jsxs("div",{className:"flex flex-col h-full bg-black text-white p-4 pb-safe",children:[e.jsxs("div",{className:"w-full max-w-md mx-auto flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"text-center mb-4 flex-shrink-0",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 mb-2 shadow-lg shadow-green-500/20",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-lg font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent",children:d("app_name")})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[e.jsx("h2",{className:"text-base font-semibold text-white",children:d("sessions_title")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(!0),className:"p-2 text-gray-400 hover:text-purple-400 transition-colors",title:d("ai_settings_title"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsx("button",{onClick:j,disabled:k,className:"p-2 text-gray-400 hover:text-white transition-colors disabled:opacity-50",title:d("session_refresh"),children:e.jsx("svg",{className:`w-4 h-4 ${k?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx(le,{}),e.jsxs("button",{onClick:v,className:"text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{className:"hidden sm:inline",children:d("logout")})]})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto space-y-2 mb-3 pr-1",children:E.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-500 bg-gray-900/50 rounded-xl border border-gray-800/50",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("p",{children:d("sessions_empty")})]}):E.map(s=>{const l=g[s.id]??!1;return e.jsxs("div",{onClick:()=>t(s.id),className:`bg-gray-900/60 backdrop-blur-sm rounded-xl p-3 transition-all cursor-pointer active:scale-[0.98] ${s.is_ghost?"border border-dashed border-gray-600":s.is_persistent?"border border-yellow-600/40":"border border-gray-800/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-mono text-sm font-semibold text-gray-100 truncate flex-1 min-w-0",children:s.title||`Session ${s.id.substring(0,8)}`}),b&&m[s.id]?e.jsx(ce,{tag:m[s.id].tag,description:m[s.id].description}):e.jsx("span",{className:`inline-block w-2 h-2 rounded-full flex-shrink-0 ${s.is_ghost?"bg-gray-500":s.state==="active"?"bg-green-500":"bg-yellow-500"}`,title:s.is_ghost?d("session_state_ghost"):s.state==="active"?d("session_state_active"):d("session_state_idle")}),e.jsx("button",{onClick:h=>S(h,s.id,!!s.is_persistent),className:`p-1.5 rounded-md transition-all ${s.is_persistent?"text-yellow-400 bg-yellow-600/20":"text-gray-500 hover:text-yellow-400 hover:bg-gray-800"}`,title:s.is_persistent?d("session_persist_remove"):d("session_persist_add"),children:e.jsx("svg",{className:"w-4 h-4",fill:s.is_persistent?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}),e.jsx("button",{onClick:h=>H(h,s.id),className:`p-1.5 rounded-md transition-all ${l?"text-blue-400 bg-blue-600/20":"text-gray-500 hover:text-blue-400 hover:bg-gray-800"}`,title:d(l?"session_notify_on":"session_notify_off"),children:e.jsx("svg",{className:"w-4 h-4",fill:l?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1.5 min-w-0 flex-1",children:[b&&m[s.id]?e.jsx("span",{className:"truncate",children:m[s.id].description}):e.jsx("span",{children:s.is_ghost?d("session_state_ghost"):s.state==="active"?d("session_state_active"):d("session_state_idle")}),e.jsx("span",{className:"text-gray-700 flex-shrink-0",children:"â€¢"}),e.jsx("span",{className:"flex-shrink-0",children:de(s.last_active,d)})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[s.tmux_cmd&&!s.is_ghost&&e.jsx("button",{onClick:h=>L(h,s.tmux_cmd),className:"p-1.5 text-gray-500 hover:text-blue-400 hover:bg-gray-800 rounded-md transition-all",title:d("session_copy_tmux"),children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),e.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]})}),e.jsx("button",{onClick:h=>C(h,s.id),className:"p-1.5 text-gray-500 hover:text-red-400 hover:bg-gray-800 rounded-md transition-all",title:d("delete"),children:e.jsx("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),t(s.id)},className:"px-2.5 py-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-md font-medium transition-all text-xs shadow-lg shadow-green-500/10",children:s.is_ghost?d("session_revive"):d("session_join")})]})]})]},s.id)})}),e.jsxs("div",{className:"flex-shrink-0 bg-gray-900/40 backdrop-blur-sm rounded-xl p-3 border border-gray-800/50",children:[e.jsx("input",{type:"text",value:y,onChange:s=>_(s.target.value),placeholder:d("session_name_placeholder"),className:"w-full px-3 py-2 bg-black/50 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 transition-all mb-2 text-sm",onKeyDown:s=>s.key==="Enter"&&T()}),e.jsxs("button",{onClick:T,className:"w-full py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-lg font-semibold transition-all flex items-center justify-center gap-2 shadow-lg shadow-green-500/20 text-sm",children:[e.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),e.jsx("span",{children:d("session_create")})]})]})]}),e.jsx(ue,{isOpen:z,onClose:()=>B(!1)})]})},U={autoReconnect:!0,lastSessionId:null,defaultWorkingDirectory:"~",fontSize:16,displayMode:"fit",fixedTerminalSize:{cols:100,rows:30},zoomLevel:1},be=he()(me(n=>({...U,setAutoReconnect:t=>n({autoReconnect:t}),setLastSessionId:t=>n({lastSessionId:t}),setDefaultWorkingDirectory:t=>n({defaultWorkingDirectory:t}),setFontSize:t=>n({fontSize:t}),setDisplayMode:t=>n({displayMode:t}),setFixedTerminalSize:t=>n({fixedTerminalSize:t}),setZoomLevel:t=>n({zoomLevel:Math.max(.5,Math.min(2,t))}),resetZoom:()=>n({zoomLevel:1}),reset:()=>n(U)}),{name:"winterm-settings",partialize:n=>({autoReconnect:n.autoReconnect,lastSessionId:n.lastSessionId,defaultWorkingDirectory:n.defaultWorkingDirectory,fontSize:n.fontSize,displayMode:n.displayMode,fixedTerminalSize:n.fixedTerminalSize,zoomLevel:n.zoomLevel})}));function ve({status:n}){const u={connecting:{color:"bg-yellow-500",animate:"animate-pulse"},connected:{color:"bg-green-500",animate:""},disconnected:{color:"bg-red-500 ring-1 ring-red-400",animate:""}}[n];return e.jsx("div",{className:`w-2 h-2 rounded-full ${u.color} ${u.animate}`,"aria-label":`Connection status: ${n}`})}function je({status:n,sessionTitle:t,onReconnect:u,onLogout:c,onBackToSessions:v}){const{t:o}=Y(),i=n==="disconnected";return e.jsxs("div",{className:`h-11 flex items-center justify-between px-2 shrink-0 transition-colors duration-200 ${i?"bg-red-900/20":"bg-gray-900/80 backdrop-blur"}`,children:[e.jsx("button",{onClick:v,className:"p-2 text-gray-400 active:bg-gray-700 rounded-lg transition-colors",title:o("session_back"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2 min-w-0 px-2",children:[e.jsx(ve,{status:n}),e.jsx("span",{className:"text-white text-sm font-medium truncate max-w-[160px]",children:t||o("app_name")}),i&&e.jsx("button",{onClick:u,className:"text-blue-400 text-xs px-2 py-0.5 bg-blue-500/10 rounded active:bg-blue-500/20",children:o("reconnect")})]}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 active:bg-gray-700 rounded-lg transition-colors",title:o("logout"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})}function we({visible:n,onClick:t}){return n?e.jsx("button",{onClick:t,className:"absolute right-4 bottom-4 w-10 h-10 rounded-full bg-gray-800/90 text-gray-300 flex items-center justify-center shadow-lg active:bg-gray-700 transition-all duration-200","aria-label":"Scroll to bottom",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}):null}function ye(n){const t=n.querySelector(".xterm-helper-textarea");if(!t)return()=>{};n.__mobileInput=t,t.dataset.allowFocus="false";const u=v=>{t.dataset.allowFocus!=="true"&&(v.preventDefault(),t.blur())},c=v=>{t.dataset.allowFocus!=="true"&&setTimeout(()=>{document.activeElement===t&&t.dataset.allowFocus!=="true"&&t.blur()},0)};return t.addEventListener("focus",u),n.addEventListener("touchend",c,{passive:!0}),()=>{delete n.__mobileInput,t.removeEventListener("focus",u),n.removeEventListener("touchend",c)}}const K=4,Z=2,Se=.2;function ke({socket:n,fontSize:t,fixedSize:u,isInputActive:c,onTerminalReady:v}){const o=a.useRef(null),i=a.useRef(null),j=a.useRef(null),k=a.useRef(null),y=a.useRef(null),[_,z]=a.useState(!1),B=a.useRef(null),g=a.useRef({lastY:0,lastX:0,delta:0,direction:0,lastSendTime:0}),R=a.useCallback((b,m,C)=>{o.current=b,i.current=m,j.current=C,y.current=ye(m),v==null||v(b)},[v]);a.useEffect(()=>{const b=B.current;if(!b)return;const m=L=>{const S=L.touches[0];g.current={lastY:S.clientY,lastX:S.clientX,delta:0,direction:0,lastSendTime:0}},C=L=>{L.preventDefault(),L.stopPropagation();const S=o.current,H=i.current;if(!S||!H)return;const T=L.touches[0],E=T.clientY,s=T.clientX,l=g.current.lastY-E;g.current.lastY=E,g.current.lastX=s;const h=l>0?1:l<0?-1:0;g.current.direction===0?Math.abs(l)>Z&&(g.current.direction=h,g.current.delta+=l):h===g.current.direction?g.current.delta+=l:Math.abs(l)>Z*2&&(g.current.direction=h,g.current.delta=l);const N=performance.now();for(;Math.abs(g.current.delta)>=K&&!(N-g.current.lastSendTime<Se);){const A=H.getBoundingClientRect(),P=S.cols||80,F=S.rows||24;let I=Math.ceil((s-A.left)/(A.width/P)),O=Math.ceil((E-A.top)/(A.height/F));I=Math.max(1,Math.min(I,P)),O=Math.max(1,Math.min(O,F)),g.current.delta>0?(n.sendInput(`\x1B[<65;${I};${O}M`),g.current.delta-=K):(n.sendInput(`\x1B[<64;${I};${O}M`),g.current.delta+=K),g.current.lastSendTime=N}};return b.addEventListener("touchstart",m,{passive:!0,capture:!0}),b.addEventListener("touchmove",C,{passive:!1,capture:!0}),()=>{b.removeEventListener("touchstart",m,{capture:!0}),b.removeEventListener("touchmove",C,{capture:!0})}},[n]),a.useEffect(()=>{const b=i.current;if(!b)return;const m=b.__mobileInput;m&&(c?(m.dataset.allowFocus="true",m.focus(),j.current&&(setTimeout(j.current,100),setTimeout(j.current,300),setTimeout(j.current,500))):(m.blur(),m.dataset.allowFocus="false",j.current&&(setTimeout(j.current,100),setTimeout(j.current,300))))},[c]),a.useEffect(()=>()=>{var b,m;(b=k.current)==null||b.call(k),(m=y.current)==null||m.call(y)},[]);const d=a.useCallback(()=>{var b;(b=o.current)==null||b.scrollToBottom(),z(!1)},[]);return e.jsxs("div",{ref:B,className:"flex-1 overflow-hidden relative",style:{touchAction:"none"},children:[e.jsx(fe,{socket:n,fontSize:t,fixedSize:u,disableClickFocus:!0,onTerminalReady:R}),e.jsx(we,{visible:_,onClick:d})]})}function D({label:n,onPress:t,wide:u=!1,highlight:c=!1}){return e.jsx("button",{onClick:t,className:`text-xs py-2 rounded active:bg-gray-700 min-h-[40px] transition-colors ${u?"px-3":"px-2 min-w-[40px]"} ${c?"bg-gray-700 text-yellow-400":"bg-gray-800 text-gray-300"}`,children:n})}function Ne({isOpen:n,onSendKey:t}){if(!n)return null;const u=[{label:"^C",code:"",desc:"Interrupt"},{label:"^D",code:"",desc:"EOF"},{label:"^Z",code:"",desc:"Suspend"},{label:"^L",code:"\f",desc:"Clear"},{label:"^A",code:"",desc:"Home"},{label:"^E",code:"",desc:"End"},{label:"^U",code:"",desc:"Kill line"},{label:"^K",code:"\v",desc:"Kill to end"},{label:"^W",code:"",desc:"Kill word"},{label:"^R",code:"",desc:"Search"},{label:"^P",code:"",desc:"Prev"},{label:"^N",code:"",desc:"Next"}],c=["F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],v={F1:"\x1BOP",F2:"\x1BOQ",F3:"\x1BOR",F4:"\x1BOS",F5:"\x1B[15~",F6:"\x1B[17~",F7:"\x1B[18~",F8:"\x1B[19~",F9:"\x1B[20~",F10:"\x1B[21~",F11:"\x1B[23~",F12:"\x1B[24~"},o=[{label:"HOME",code:"\x1B[H"},{label:"END",code:"\x1B[F"},{label:"PGUP",code:"\x1B[5~"},{label:"PGDN",code:"\x1B[6~"},{label:"INS",code:"\x1B[2~"},{label:"DEL",code:"\x1B[3~"}];return e.jsxs("div",{className:"bg-gray-900 border-t border-gray-800 p-2 space-y-3 animate-in slide-in-from-bottom duration-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"Ctrl ç»„åˆé”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:u.map(i=>e.jsx(D,{label:i.label,onPress:()=>t(i.code),highlight:!0},i.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"æ–¹å‘é”®"}),e.jsx("div",{className:"flex justify-center gap-1",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsx("div",{}),e.jsx(D,{label:"â†‘",onPress:()=>t("\x1B[A")}),e.jsx("div",{}),e.jsx(D,{label:"â†",onPress:()=>t("\x1B[D")}),e.jsx(D,{label:"â†“",onPress:()=>t("\x1B[B")}),e.jsx(D,{label:"â†’",onPress:()=>t("\x1B[C")})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"å¯¼èˆªé”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:o.map(i=>e.jsx(D,{label:i.label,onPress:()=>t(i.code),wide:!0},i.label))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs mb-1 px-1 text-center",children:"åŠŸèƒ½é”®"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:c.map(i=>e.jsx(D,{label:i,onPress:()=>t(v[i])},i))})]})]})}function $({label:n,onClick:t,className:u=""}){return e.jsx("button",{onClick:t,className:`text-gray-300 text-xs px-2 py-2 bg-gray-800 rounded active:bg-gray-700 min-w-[40px] min-h-[44px] transition-colors ${u}`,children:n})}function _e({onSendKey:n,isInputActive:t,onInputToggle:u}){const[c,v]=a.useState(!1),o=i=>{n(i)};return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{isOpen:c,onSendKey:o}),e.jsxs("div",{className:"flex items-center justify-around bg-gray-900 shrink-0 px-2 py-1 gap-1",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsx("button",{onClick:u,className:`text-xs font-medium px-3 py-2 rounded min-w-[50px] min-h-[44px] transition-colors border-2 ${t?"bg-blue-600 border-blue-400 text-white":"bg-gray-900 border-blue-500 text-blue-400 active:bg-blue-900"}`,children:t?"âŒ¨ ON":"âŒ¨"}),e.jsx($,{label:"ESC",onClick:()=>o("\x1B")}),e.jsx($,{label:"TAB",onClick:()=>o("	")}),e.jsx($,{label:"â†‘",onClick:()=>o("\x1B[A")}),e.jsx($,{label:"â†“",onClick:()=>o("\x1B[B")}),e.jsx("button",{onClick:()=>o("\r"),className:"text-xs font-medium px-3 py-2 rounded min-w-[44px] min-h-[44px] transition-colors bg-green-700 text-white active:bg-green-600",children:"âŽ"}),e.jsx("button",{onClick:()=>v(!c),className:"text-gray-300 text-xs px-2 py-2 bg-gray-800 rounded active:bg-gray-700 min-w-[40px] min-h-[44px] transition-colors",children:c?"â–¼":"â€¢â€¢â€¢"})]})]})}function Ce(n){const[t,u]=a.useState(null),c=a.useRef(null),v=a.useRef(!1);return a.useEffect(()=>{const o=window.visualViewport;if(!o)return;c.current===null&&(c.current=o.height);const i=()=>{const j=o.height;u(j),o.offsetTop>0&&window.scrollTo(0,0);const k=c.current;if(k){const _=k-j>100;v.current&&!_&&(n==null||n()),v.current=_}};return i(),o.addEventListener("resize",i),o.addEventListener("scroll",i),()=>{o.removeEventListener("resize",i),o.removeEventListener("scroll",i)}},[n]),t}function Ee(){const[n,t]=a.useState("disconnected"),[u,c]=a.useState("loading"),[v,o]=a.useState([]),[i,j]=a.useState(),[k,y]=a.useState(""),[_,z]=a.useState(""),[B,g]=a.useState(!1),[R,d]=a.useState(!1),b=a.useRef(null),m=a.useRef(!1),C=a.useRef(!1),{t:L}=Y(),{defaultWorkingDirectory:S,fontSize:H,displayMode:T,fixedTerminalSize:E,setLastSessionId:s}=be(),{consumeModifiers:l}=G(),h=V(r=>r.setSummary),N=V(r=>r.setAiEnabled),A=a.useCallback(()=>{g(!1)},[]),P=Ce(A),F=a.useCallback(async r=>{if(!m.current){m.current=!0,t("connecting"),y("");try{const{ws_url:x}=await w.attachSession(r);M.connectWithToken(x,r),j(r),s(r),localStorage.setItem("winterm_session",r)}catch(x){y(x instanceof Error?x.message:"Failed to connect"),t("disconnected"),c("selecting_session"),j(void 0)}finally{m.current=!1}}},[s]);a.useEffect(()=>{if(C.current)return;C.current=!0,(async()=>{try{if(!(await w.validateToken()).valid){c("unauthenticated");return}const{sessions:f}=await w.listSessions();if(o(f),f.length===0){const{session:p}=await w.createSession({workingDirectory:S});o([p])}c("selecting_session")}catch{c("unauthenticated")}})()},[S]),a.useEffect(()=>{const r=M.onOpen(()=>{t("connected"),y("")}),x=M.onClose(()=>{t("disconnected")}),f=M.onError(p=>{y(p),t("disconnected")});return()=>{r(),x(),f()}},[]),a.useEffect(()=>{if(u!=="selecting_session"&&u!=="ready")return;const r=async()=>{try{const f=await w.getAIConfig();N(f.enabled&&f.running);const{summaries:p}=await w.getAISummaries();Object.entries(p).forEach(([ie,W])=>{h(ie,{tag:W.tag,description:W.description,timestamp:W.timestamp})})}catch{}};r();const x=setInterval(r,1e4);return()=>clearInterval(x)},[u,h,N]);const I=async r=>{try{z("");const{token:x}=await w.authenticate(r);localStorage.setItem("winterm_token",x);const{sessions:f}=await w.listSessions();if(o(f),f.length===0){const{session:p}=await w.createSession({workingDirectory:S});o([p]),c("ready"),F(p.id)}else c("selecting_session")}catch(x){z(x instanceof Error?x.message:"Authentication failed")}},O=r=>{c("ready"),F(r)},q=async r=>{const{session:x}=await w.createSession({title:r,workingDirectory:S});o(f=>[...f,x]),c("ready"),F(x.id)},Q=async r=>{await w.deleteSession(r),o(x=>x.filter(f=>f.id!==r))},J=async()=>{d(!0);try{const{sessions:r}=await w.listSessions();o(r)}catch{}finally{d(!1)}},ee=async(r,x)=>{o(f=>f.map(p=>p.id===r?{...p,is_persistent:!x}:p));try{x?await w.unpersistSession(r):await w.persistSession(r)}catch{o(f=>f.map(p=>p.id===r?{...p,is_persistent:x}:p))}},X=()=>{M.disconnect(),localStorage.removeItem("winterm_token"),localStorage.removeItem("winterm_session"),c("unauthenticated"),t("disconnected"),j(void 0),o([])},te=a.useCallback(r=>{b.current=r},[]),se=()=>{i&&F(i)},ne=a.useCallback(async()=>{M.disconnect(),j(void 0);try{const{sessions:r}=await w.listSessions();o(r)}catch{}c("selecting_session")},[]),re=a.useCallback(r=>{const{modifiers:x}=G.getState();let f=r;if(x.ctrl!=="idle"&&r.length===1){const p=r.charCodeAt(0);p>=97&&p<=122?f=String.fromCharCode(p-96):p>=65&&p<=90&&(f=String.fromCharCode(p-64))}x.alt!=="idle"&&(f=`\x1B${f}`),M.sendInput(f),l()},[l]),oe=a.useCallback(()=>{g(r=>!r)},[]),ae=()=>{if(u==="unauthenticated")return e.jsx(ge,{onSubmit:I,error:_});if(u==="loading")return e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-600 mb-4 shadow-lg shadow-green-500/20",children:e.jsx("svg",{className:"w-7 h-7 text-white animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"text-gray-400",children:L("loading")})]})});if(u==="selecting_session")return e.jsx(pe,{sessions:v,onSelect:O,onCreate:q,onDelete:Q,onLogout:X,onTogglePersist:ee,onRefresh:J,isRefreshing:R});const r=v.find(x=>x.id===i);return e.jsxs(e.Fragment,{children:[e.jsx(je,{status:n,sessionTitle:(r==null?void 0:r.title)||(i?`Session ${i.substring(0,8)}`:void 0),onReconnect:se,onLogout:X,onBackToSessions:ne}),k&&e.jsx("div",{className:"bg-red-900/50 text-red-300 text-sm px-3 py-2 shrink-0",children:k}),e.jsx(ke,{socket:M,fontSize:H,fixedSize:T==="fixed"?E:void 0,isInputActive:B,onTerminalReady:te}),e.jsx(_e,{onSendKey:re,isInputActive:B,onInputToggle:oe})]})};return e.jsx("div",{className:"flex flex-col bg-black overflow-hidden fixed inset-0",style:{height:P?`${P}px`:"100dvh"},children:ae()})}export{Ee as default};
